### 计算机网络

#### 交换

电路交换：独占，需要建立连接，传输块。

分组交换：无连接，需要分组头，非实时有延迟，丢包等。

------

#### 时延

传输时延：路由器发送；传播时延：信道传输电磁波；排队：顾名思义；处理：路由器处理数据帧。

------

#### 体系结构

OSI：应用层（HTTP、DNS、FTP、SFTP），表示层，会话层，运输层（TCP，UDP），网络层（IP、ICMP、IGMP、ARP），数据链路层（CSMA，PPP，交换机），物理层（网卡、集线器）。

TCP/IP：应用层，运输层，网际层，数据接口层。

五层协议：应用层，运输层，网络层，数据链路层，物理层。

------

#### 物理层

how to transfer signal.

##### 通信方式

单工（单向单路），半双工（双向双路），全双工（双向四路）。

##### 带通调制

数字信号，调幅，调频，调相。

------

#### 数据链路层

数据报——>数据帧，标记帧开始与帧结束。

##### 透明传输

帧开始符SOH，帧结束符EOH，数据填充转义符以转义SOH、EOH和转义符。

##### CRC循环取余

除数n位，则补n-1个0到被除数末尾，然后异或。

##### 信道

广播信道（信道复用，CSMA/CD），点对点信道（PPP协议）。

##### 信道复用

频分复用，C=W*log（1-S/N），时分复用，统计时分复用（需要记录帧的用户信息），码分复用（取 m=8，设码片为 00011011。在拥有该码片的用户发送比特 1 时就发送该码片，发送比特 0 时就发送该码片的反码 11100100，结果为 0 的是其它用户发送的数据，结果为 1 的是用户发送的比特 1，结果为 -1 的是用户发送的比特 0）。

##### CSMA/CD（碰撞检测）

![img](https://github.com/apachecn/baguwen-wiki/raw/master/docs/img/5aa82b89-f266-44da-887d-18f31f01d8ef.png)

##### PPP

7E分隔符，fcsCRC验证。![img](https://github.com/apachecn/baguwen-wiki/raw/master/docs/img/69f16984-a66f-4288-82e4-79b4aa43e835.jpg)

##### MAC地址

数据链路层，表示主机的网卡。

##### 局域网（以太网）

星形网，帧格式![img](https://github.com/apachecn/baguwen-wiki/raw/master/docs/img/50d38e84-238f-4081-8876-14ef6d7938b5.jpg)

##### 交换机

自学习能力。

##### 虚拟局域网

虚拟局域网可以建立与物理位置无关的逻辑组。使用 VLAN 干线连接来建立虚拟局域网，每台交换机上的一个特殊接口被设置为干线接口，以互连 VLAN 交换机。IEEE 定义了一种扩展的以太网帧格式 802.1Q，它在标准以太网帧上加进了 4 字节首部 VLAN 标签，用于表示该帧属于哪一个虚拟局域网。

------

#### 网络层

##### IP

传统划分，子网划分，CIDR

##### IP格式

首部+数据==IP数据报

##### 协议

ARP：地址解析协议，IP地址到MAC地址

ICMP：网络控制报文协议，询问报文和差错报文，ping（发送echo请求，根据echo回答的时间和相应次数判定往返时间和丢包），Traceroute（跟踪源点到终点的每个路由器的往返时间和ip地址）。

##### VPN

10.0.0.0-10.255.255.255

172.16.0.0——172.31.255.255

192.168.0.0——192.168.255.255

##### NAT

本地ip和公网ip的转换表

##### 路由器

内部网关协议（RIP，OSPF），外部网关协议BGP（相邻发言人TCP连接交换路由信息，较好而非最佳）。

------

### 运输层

#### UDP

用户数据报协议 UDP（User Datagram Protocol）是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。

![img](https://github.com/apachecn/baguwen-wiki/raw/master/docs/img/d4c3a4a1-0846-46ec-9cc3-eaddfca71254.jpg)

#### TCP

传输控制协议 TCP（Transmission Control Protocol）是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是点对点的（一对一）。

![img](https://github.com/apachecn/baguwen-wiki/raw/master/docs/img/55dc4e84-573d-4c13-a765-52ed1dd251f9.png)

序号seq为 第一个字节编号

数据偏移：首部长度

ACK 标志 确认 连接后一直为1，ack为期望的下次发送序号，一般是当前序号加长度。

SYN 表示 同步， SYN = 1 ACK = 0为请求连接 SYN = ACK  = 1 为同意连接

FIN 标志释放连接 FIN=1请求释放连接

窗口：接受让发送方设置发送窗口的依据

#### 三次握手

![img](https://github.com/apachecn/baguwen-wiki/raw/master/docs/img/e92d0ebc-7d46-413b-aec1-34a39602f787.png)

假设 A 为客户端，B 为服务器端。

- 首先 B 处于 LISTEN（监听）状态，等待客户的连接请求。
- A 向 B 发送连接请求报文，SYN=1，ACK=0，选择一个初始的序号 x。
- B 收到连接请求报文，如果同意建立连接，则向 A 发送连接确认报文，SYN=1，ACK=1，确认号为 x+1，同时也选择一个初始的序号 y。
- A 收到 B 的连接确认报文后，还要向 B 发出确认，确认号为 y+1，序号为 x+1。
- B 收到 A 的确认后，连接建立。

**三次握手的原因**

第三次握手是为了防止失效的连接请求到达服务器，让服务器错误打开连接。

客户端发送的连接请求如果在网络中滞留，那么就会隔很长一段时间才能收到服务器端发回的连接确认。客户端等待一个超时重传时间之后，就会重新请求连接。但是这个滞留的连接请求最后还是会到达服务器，如果不进行三次握手，那么服务器就会打开两个连接。如果有第三次握手，客户端会忽略服务器之后发送的对滞留连接请求的连接确认，不进行第三次握手，因此就不会再次打开连接。

#### TCP四次挥手

![img](https://github.com/apachecn/baguwen-wiki/raw/master/docs/img/f87afe72-c2df-4c12-ac03-9b8d581a8af8.jpg)

- A 发送连接释放报文，FIN=1。
- B 收到之后发出确认，此时 TCP 属于半关闭状态，B 能向 A 发送数据但是 A 不能向 B 发送数据。
- 当 B 不再需要连接时，发送连接释放报文，FIN=1。
- A 收到后发出确认，进入 TIME-WAIT 状态，等待 2 MSL（最大报文存活时间）后释放连接。
- B 收到 A 的确认后释放连接。

**四次挥手的原因**

客户端发送了 FIN 连接释放报文之后，服务器收到了这个报文，就进入了 CLOSE-WAIT 状态。这个状态是为了让服务器端发送还未传送完毕的数据，传送完毕之后，服务器会发送 FIN 连接释放报文。

**TIME_WAIT**

客户端接收到服务器端的 FIN 报文后进入此状态，此时并不是直接进入 CLOSED 状态，还需要等待一个时间计时器设置的时间 2MSL。这么做有两个理由：

- 确保最后一个确认报文能够到达。如果 B 没收到 A 发送来的确认报文，那么就会重新发送连接释放请求报文，A 等待一段时间就是为了处理这种情况的发生。
- 等待一段时间是为了让本连接持续时间内所产生的所有报文都从网络中消失，使得下一个新的连接不会出现旧的连接请求报文。

#### TCP可靠传输



